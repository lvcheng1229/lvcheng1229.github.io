<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"lvcheng1229.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="This blog will introduce the personal Vulkan bindless ray tracing implementation in CryEngine and discuss the hardware architecture and theory behind real-time ray tracing. This article is divided int">
<meta property="og:type" content="article">
<meta property="og:title" content="Bindless Vulkan RayTraing In CryEngine[Part1]">
<meta property="og:url" content="https://lvcheng1229.github.io/2023/08/01/cerhivkrt/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="This blog will introduce the personal Vulkan bindless ray tracing implementation in CryEngine and discuss the hardware architecture and theory behind real-time ray tracing. This article is divided int">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-07-31T16:08:24.000Z">
<meta property="article:modified_time" content="2023-12-01T04:41:21.292Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://lvcheng1229.github.io/2023/08/01/cerhivkrt/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://lvcheng1229.github.io/2023/08/01/cerhivkrt/","path":"2023/08/01/cerhivkrt/","title":"Bindless Vulkan RayTraing In CryEngine[Part1]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Bindless Vulkan RayTraing In CryEngine[Part1] | Hexo</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hexo</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#RayTracing-Acceleration-Structure"><span class="nav-number">1.</span> <span class="nav-text">RayTracing Acceleration Structure</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#A-Brief-Introduction"><span class="nav-number">1.1.</span> <span class="nav-text">A Brief Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#BVH"><span class="nav-number">1.1.1.</span> <span class="nav-text">BVH</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Two-Level-Acceleration-Structure"><span class="nav-number">1.1.2.</span> <span class="nav-text">Two-Level Acceleration Structure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Trade-Offs-of-The-Structure-Building"><span class="nav-number">1.1.3.</span> <span class="nav-text">The Trade-Offs of The Structure Building</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tips"><span class="nav-number">1.1.4.</span> <span class="nav-text">Tips</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#deffered"><span class="nav-number">1.1.5.</span> <span class="nav-text">deffered</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ray-Transversal-And-Intersection"><span class="nav-number">1.1.6.</span> <span class="nav-text">Ray Transversal And Intersection</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Implementation-Details"><span class="nav-number">1.2.</span> <span class="nav-text">Implementation Details</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Extended"><span class="nav-number">1.3.</span> <span class="nav-text">Extended</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lvcheng1229.github.io/2023/08/01/cerhivkrt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Bindless Vulkan RayTraing In CryEngine[Part1] | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Bindless Vulkan RayTraing In CryEngine[Part1]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-01 00:08:24" itemprop="dateCreated datePublished" datetime="2023-08-01T00:08:24+08:00">2023-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-12-01 12:41:21" itemprop="dateModified" datetime="2023-12-01T12:41:21+08:00">2023-12-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>This blog will introduce the personal Vulkan bindless ray tracing implementation in CryEngine and discuss the hardware architecture and theory behind real-time ray tracing. This article is divided into four parts: Building the Acceleration Structure, RayTracing Shaders, RayTracing Pipeline and Bindless Ray Tracing.</p>
<p>Before DXR and Vulkan Ray Tracing API, NVIDIA had already developed a ray tracing API called Optix around 2009. Optix is similar to the other two APIs in some respects. By the way, I discovered Optix before Vulkan RayTracing too, since my undergraduate thesis is based on Optix. Almost ten years after the release of Optix, Microsoft released DXR in 2018 and Vulkan TSG released Vulkan RayTracing in 2020. Vulkan and DXR ray tracing are same in many parts. Unlike Optix, DXR and Vulkan RayTracing are designed for real-time rendering pipelines. They can share resources between raytracing and rasterization pipelines, which has advantages in hybrid rendering.</p>
<p>Compared to traditional rasterization-based rendering, raytracing is more direct and can generate a more realistic image.</p>
<p>todo@todo@</p>
<h1 id="RayTracing-Acceleration-Structure"><a href="#RayTracing-Acceleration-Structure" class="headerlink" title="RayTracing Acceleration Structure"></a>RayTracing Acceleration Structure</h1><p>“A Brief Introduction” part provides a brief introduction to acceleration structure, such as constructing acceleration structure, ray intersection and ray transversal. “Implementation Details” part dicribes the implementation details of building the acceleration structure in CryEngine. “Extended” part discusses low-level  possible hardware implementations, such as BVH construction schemes (LBVH, Binding SAH,etc) and ray transversal optimization and methods.</p>
<h2 id="A-Brief-Introduction"><a href="#A-Brief-Introduction" class="headerlink" title="A Brief Introduction"></a>A Brief Introduction</h2><h3 id="BVH"><a href="#BVH" class="headerlink" title="BVH"></a>BVH</h3><p>Both DXR and Vulkan RayTracing use bounding volume hierarchies (BVH) for acceleration, which is also commonly used for offline ray tracing. BVH is an object partition data structure. It has more advantages than space partition (BSP-Tree,Octree,etc). One advantage of BVH is that the scene can be rebuilt easily for dynamic objects: just recompute the leaf node based on the current geometry. Additionally, the two-level acceleration structure employed in the current raytracing API can optimize rigid body animation further: only update the transform matrix without the expensive bottom-level acceleration structure update. Another advantage of BVH is that the maximum size used is known, as the number of leaves is limited.</p>
<h3 id="Two-Level-Acceleration-Structure"><a href="#Two-Level-Acceleration-Structure" class="headerlink" title="Two-Level Acceleration Structure"></a>Two-Level Acceleration Structure</h3><p>Vulkan employs a two-level acceleration structure to accelerate scene transversal and ray intersections. The bottom-level acceleration structure (BLAS) contains a set of geometries. In the Vulkan API, we can set two types of geometries: <strong>triangles or procedural</strong>. The former type contains a set of triangles, that is to say, real vertex data and index data. Additionally, the BLAS with triangle geometry type contains AABB to encapsulate the geometry after it has been built. For the later geometry type, we should specify AABBs and the associated intersection function such as the ray-sphere test function. In practice, we <strong>prefer using triangle geometry</strong>, since both triangles and AABBs are hardware accelerated, but the procedural type involves additional user defined intersection functions in a shader, which is slower.</p>
<p><strong>[IMAGE]</strong></p>
<p>The top-level acceleration structure (TLAS) consists of instances that reference the BLAS. And each instance contains a transform. We can only update the instance transform of TLAS for rigid-body animation.</p>
<h3 id="The-Trade-Offs-of-The-Structure-Building"><a href="#The-Trade-Offs-of-The-Structure-Building" class="headerlink" title="The Trade-Offs of The Structure Building"></a>The Trade-Offs of The Structure Building</h3><p>The driver is responsible for scheduling construction tasks after requesting the acceleration structure building. And the highly parallel work (calculate AABB, sorte) can accelerated by GPU. In addition, <strong>AS management (build&#x2F;updata) can be moved to an async compute queue</strong>, which could completely hide the cost in many cases. AS management is essentialy software-based work, which allows the driver to optimize its construction algorithm continuously.</p>
<p>Vulkan exposed three build options to AS management:<br>For the PREFER_FAST_TRACE bit, the GPU should choose the algorithm with better runtime transversal efficiency.<br>For the PREFER_FAST_BUILD bit, the GPU should choose the algorithm with a faster construction rate.<br>For the default option, GPU should choose a compromise solution with a balance between trace and build speed.<br>Generally, we <strong>employ PREFER_FAST_BUILD for BLAS, as well as PREFER_FAST_TRACE for TLAS</strong>.<br>In the later extend part, we will discuss three algorithms corresponding to PREFER_FAST_TRACE, PREFER_FAST_BUILD and default option.</p>
<p>Ray tracing has more geometries in GPU memory than traditional rasterization methods. Vulkan has provided additional options for compacting the acceleration structure. Generally, we only compact BLAS, since it has more geometry data than TLAS</p>
<h3 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h3><h3 id="deffered"><a href="#deffered" class="headerlink" title="deffered"></a>deffered</h3><h3 id="Ray-Transversal-And-Intersection"><a href="#Ray-Transversal-And-Intersection" class="headerlink" title="Ray Transversal And Intersection"></a>Ray Transversal And Intersection</h3><h2 id="Implementation-Details"><a href="#Implementation-Details" class="headerlink" title="Implementation Details"></a>Implementation Details</h2><h2 id="Extended"><a href="#Extended" class="headerlink" title="Extended"></a>Extended</h2>
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/08/01/cesvsm/" rel="prev" title="GPU-Driven Virtual Shadow Map In CryEngine">
                  <i class="fa fa-angle-left"></i> GPU-Driven Virtual Shadow Map In CryEngine
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/08/02/cerrtb/" rel="next" title="CryEngine Baking:Real Time RayTracing Baker">
                  CryEngine Baking:Real Time RayTracing Baker <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">John Doe</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
